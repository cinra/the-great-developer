# 外部サービス > Oauth

## 課題

- [ ] OAuth認証について理解する

---

## 解説

<a name="about"></a>
### OAuthとは。OAuthでできる事。

まず、コチラの[ IT用語辞典バイナリ](http://www.weblio.jp/content/OAuth)にOAuthの技術的な部分について詳しく記述されていますので抑えておいてください。

参考記事を読んで頂いた上で更に少し噛み砕くと、以下のようになります。

仮に「OAuth認証を提供しているサービス」を「OAuthサービス」として、利用先を「ECサイト（OAuthログイン可）」とすると、このECサイトで決済する際に、このECサイト専用のアカウントを新規に会員登録せず、OAuthサービスのアカウントを利用してログイン・決済処理をする事ができ、この時、ECサイトにOAuthサービスのアカウントのパスワードが漏れる事はありません。

ECサイトを初めて利用する際には必ず「会員登録」が必要になってきますが、この技術によってサイト側は簡単にユーザーを識別する事が可能になり、ユーザーにとっても「既に会員登録済のOAuthサービス」のアカウントを流用できるのであれば、あまり認知されていなかったり継続的に利用するか明確でないサイトでも、ハードルが低くなり利用しやすくなるといった点が、OAuthの特徴としてあります。

<a name="howitworks"></a>
### OAuthの仕組み

提供しているサービス毎に実装の方法は細かく違いますが、ざっくりとした仕組みについてはfacebookを例とすると以下のようになっています。（実装については既に済ませているものとします）

外部サービスで「facebookのアカウントでログインする」という処理を行うと、facebook側に「リクエストトークン」が送信されます。

このリクエストトークンには、「外部サービスが何をする権限が欲しいか」が含まれており、ユーザーはfacebookの認証画面に遷移して、与える権限の内容を確認できます。問題がない場合は、承認する事で今度は逆にfacebooから「アクセストークン」が外部サービス側に返却されます。

外部サービスはこのトークンを利用して、facebookから「許可された権限の範囲で」ユーザーの情報をjsonで得ることができるようになるので、これを利用してユーザーを識別します。

外部サービスはアクセストークンをデータベースに登録する事で、継続的にログインさせる事が可能です。  
ただし、アクセストークンには期限が存在する場合があり、期限が切れた場合は無効となります。

---