# インフラストラクチャー > 基礎 > DNS

## 課題

- [ ] DNSについて理解し、簡単な説明ができるようにする

---

## 解説

### DNSとは

インターネットに接続しているコンピュータは必ず「IPアドレス」というユニークな数字が割り振られており、インターネットを通じて他のコンピュータと疎通する場合は、このアドレスを使ってやり取りが行われます。

しかし、IPアドレスは時間によって変動し、そもそも数字の羅列であるため覚えづらく、人間が記憶しておくには不向きです。
そのため、分かりやすく「名前」で指定できるように作られた仕組みが「DNS（Domain Name System）」です。

名前（ドメイン名）はドット区切りで表され、それぞれを「ラベル」と呼びます。

www.example.co.jp

| www | example | co | jp |
|:-:|:-:|:-:|:-:|
|第4レベル|第3レベル|第2レベル|トップレベル|


ブラウザでサイトを表示した際、ラベルの右から順にIPアドレスの探索が行われ、各DNSサーバーは要求に対して対応するIPアドレスを返す仕組みになっています。

また、DNSサーバーはレイヤー構造になっており、世界中の地域、国ごとに多数存在しています。
その最も根幹の部分に「ルートサーバー」が存在しており、ここで「トップレベルドメイン（TLD）」を管理しています。

ちなみにルートサーバーは世界に13台（`a〜m.root.servers.net`）あり、「m.~」が日本管轄のルートDNSサーバーとなっています。  
また、「.jp」サーバーは`a~h.dns.jp`の8台が動いているようです。

### ドメインを使う

ドメインの利用を開始する場合は、まず「ドメイン取得サービス（お名前.com、ムームードメイン等）」から、希望するドメインを取得（購入）します。

ただ、上記の手順ではまだ「住所」を用意しただけなので、次にサービス（アプリケーション、Webサイト）を設置する「土地」を用意するために、「レンタルサーバー（さくらインターネット、ヘテムル等）」の契約をします。  
（「土地」についてはホスティング出来ればいいだけなので、レンサバ以外にもAWS S3などの手段があります）

これらが全て用意できたら、「住所」と「土地」の紐付け設定を行います。

ここでは仮に、以下の内容で取得しているものとして説明します。  
ドメイン「お名前.com（www.cinra.co.jp）」  
レンサバ「さくらインターネット（219.94.160.69）」

まず、土地を契約した「さくらインターネット側」に、「www.cinra.co.jp」が住所である事が分かるようにドメインの登録を行います。  
これで住所と土地が紐付き、上記ドメインにアクセスがあった場合、「219.94.160.69」を問い合わせます。

ただしこれだけでは、たどり着けません。  
次に、住所を契約した「お名前.com」側に「どこのDNSに問い合わせればいいのか」を登録する必要があります。

さくらインターネットの場合は以下のDNSが指定されていますので、こちらに問い合わせを行うように「お名前.com」で設定します。

プライマリ：`ns1.dns.ne.jp`
セカンダリ：`ns2.dns.ne.jp`

ここまでを終えると、「www.cinra.co.jp」へのアクセスがあった場合、サービス（アプリケーション、Webサイト）を設置している場所が正しく返され、内容が表示されます。

### サブドメインを切る

NOTE: 別途SEOの記事を作って言及

ここではサブドメインの仕組み的な事を記述します。

サブドメインは、メインドメインの子にあたる物で、例えば、「cinra.co.jp」をメインドメインとして、新たに「hoge」というサブドメイン（ホスト名）を切った場合、「hoge.cinra.co.jp」が子になります。

この設定は単純にドメイン取得サービスで「DNSレコード設定」を使い、既存の親ドメインの下層に新規ホスト名を設定する事で可能です。  
（急に「レコード」という言葉が出てきますが、詳しい説明は割愛します。サブドメを切る時は「Aレコード」を使用します）

※ この時同時に、コンテンツを利用するIPアドレスも設定します。

次に、サーバー側にも新たに作成したサブドメインを登録します。

ここまでの設定を行うと、新たに切ったサブドメインにアクセスした際も、指定したコンテンツが表示されるはずです。

ちなみに、サブドメインは同一コンテンツ内でディレクトリを切った場合と違い、別のコンテンツ（サイト内容）として評価されます。
この辺りはSEOの記事を参照してください。

---

## 参考リンク

- [ドメイン名とは - 日本ネットワークインフォメーションセンター](https://www.nic.ad.jp/ja/dom/system.html)
- [DNSとは～名前解決の仕組み - domainname.jp](http://domainname.jp/report/dns.html)